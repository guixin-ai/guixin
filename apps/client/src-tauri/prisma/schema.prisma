// 这是Prisma的数据库模式文件 - 仅供参考
// 实际项目使用的是Diesel ORM，这个文件只是为了提供更直观的数据库结构视图
// 更多信息请参考: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  // 注意：这个生成器配置仅供参考，实际项目中不会使用
}

datasource db {
  provider = "sqlite"
  // 这个路径仅供参考，实际数据库路径由应用程序代码决定
  url      = "file:./database.sqlite"
}

// 用户模型 - 简化版
model User {
  id           String       @id @default(uuid())
  name         String       // 用户名称
  description  String?      // 用户描述
  is_ai        Boolean      @default(false) // 是否为AI用户
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  
  // 关系字段
  messages     Message[]    // 发送的消息
  chats        ChatParticipant[] // 参与的聊天

  @@map("users")
}

// 聊天模型 - 简化版
model Chat {
  id           String       @id @default(uuid())
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  
  // 关系字段
  participants ChatParticipant[] // 聊天参与者
  messages     Message[]    // 聊天中的消息
  
  @@map("chats")
}

// 聊天参与者模型 - 多对多关系表
model ChatParticipant {
  id           String       @id @default(uuid())
  joinedAt     DateTime     @default(now()) @map("joined_at")
  
  // 关系字段
  chat         Chat         @relation(fields: [chatId], references: [id])
  chatId       String       @map("chat_id")
  
  user         User         @relation(fields: [userId], references: [id])
  userId       String       @map("user_id")
  
  @@unique([chatId, userId]) // 确保一个用户在一个聊天中只有一个参与记录
  @@map("chat_participants")
}

// 消息模型 - 简化版
model Message {
  id           String       @id @default(uuid())
  content      String       // 消息内容
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  
  // 关系字段
  chat         Chat         @relation(fields: [chatId], references: [id])
  chatId       String       @map("chat_id")
  
  sender       User         @relation(fields: [senderId], references: [id])
  senderId     String       @map("sender_id")

  @@map("messages")
}
