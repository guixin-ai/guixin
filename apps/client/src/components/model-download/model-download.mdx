import { Meta, Story, Canvas, Controls } from '@storybook/blocks';
import * as ModelDownloadStories from './model-download.stories';

<Meta of={ModelDownloadStories} />

# 模型下载组件

模型下载组件用于管理 Ollama 模型的下载，提供直观的用户界面来输入模型名称并显示下载进度。

## 功能特性

### 输入支持
- 支持直接输入模型名称（如：`llama2:7b-chat`）
- 支持从模型库复制命令（如：`ollama run mistral`）
- 自动提取模型名称和标签

### 下载队列管理
- 显示当前下载进度和文件大小
- 支持多模型排队下载
- 实时更新下载状态
- 支持手动重试失败的下载
- 自动断点续传，刷新页面后继续下载

### 服务状态感知
- 自动检测 Ollama 服务状态
- 服务离线时禁用下载功能

## 组件预览

### 默认状态
<Canvas>
  <Story of={ModelDownloadStories.默认状态} />
</Canvas>

默认状态展示了组件的基本外观，此时 Ollama 服务在线但没有任何下载任务。

### 属性控制
<Controls />

## 使用示例

### 基础用法

```tsx
import { ModelDownload } from '@/components/model-download';

export function MyComponent() {
  const [modelName, setModelName] = useState('');
  
  const handleDownload = (name: string) => {
    console.log('开始下载模型:', name);
  };

  return (
    <ModelDownload
      modelName={modelName}
      onModelNameChange={setModelName}
      onDownload={handleDownload}
      isServiceAvailable={true}
      isDownloading={false}
      downloadQueue={[]}
    />
  );
}
```

## 注意事项

1. 服务状态：
   - 组件会根据 `isServiceAvailable` 自动调整可用性
   - 服务离线时会禁用所有交互功能

2. 下载队列：
   - 一次只能下载一个模型
   - 其他模型会进入等待队列
   - 失败的下载可以通过重试按钮重新开始，支持断点续传
   - 每个下载项都会显示其状态（下载中、等待中、完成、失败）
   - 失败项会显示具体的错误原因

3. 暗色模式：
   - 完整支持明暗两种主题
   - 自动适应系统主题切换 